{
  "$schema":  "https://raw.githubusercontent.com/jetify-com/devbox/0.15.0/.schema/devbox.schema.json",
  "packages": ["ruby_3_4@latest", "temporal@latest", "temporal-cli@latest", "curl@latest"],
  "shell": {
    "init_hook": [
      "set +m",
      "# Start Temporal Server",
      "echo -n 'ğŸ“¡ Starting Temporal server...'",
      "temporal server start-dev > temporal-server.log 2>&1 &",
      "TEMPORAL_PID=$!",
      "for i in {1..20}; do",
      "  if temporal workflow list > /dev/null 2>&1; then",
      "    echo ' âœ… ready'",
      "    break",
      "  fi",
      "  sleep 2",
      "done",
      "",
      "# Start Rails Worker",
      "echo -n 'ğŸš€ Starting Rails Temporal worker...'",
      "bundle exec rails temporal:worker > temporal-worker.log 2>&1 &",
      "WORKER_PID=$!",
      "sleep 5",
      "if kill -0 $WORKER_PID 2>/dev/null; then",
      "  echo ' âœ… ready'",
      "else",
      "  echo ' âŒ failed to start'",
      "fi",
      "",
      "# Start Rails Server",
      "echo -n 'ğŸŒ Starting Rails server...'",
      "bundle exec rails server -p 3001 > rails-server.log 2>&1 &",
      "SERVER_PID=$!",
      "for i in {1..10}; do",
      "  if curl -s http://localhost:3001 > /dev/null 2>&1; then",
      "    echo ' âœ… ready'",
      "    break",
      "  fi",
      "  sleep 2",
      "done",
      "",
      "echo 'ğŸ‰ All services running!'",
      "echo \"â”œâ”€â”€ ğŸ“¡ Temporal Server: http://localhost:8233 (PID: $TEMPORAL_PID)\"",
      "echo \"â”œâ”€â”€ ğŸš€ Rails Worker: Running (PID: $WORKER_PID)\"", 
      "echo \"â””â”€â”€ ğŸŒ Rails API: http://localhost:3001 (PID: $SERVER_PID)\"",
      "echo ''",
      "echo 'ğŸ“‹ Log files: temporal-server.log, temporal-worker.log, rails-server.log'",
      "set -m"
    ],
    "scripts": {
      "test": [
        "echo \"Error: no test specified\" && exit 1"
      ]
    }
  }
}
